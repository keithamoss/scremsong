[supervisord]
nodaemon=true
logfile=/app/logs/supervisord.log

[program:uwsgi]
command=/usr/sbin/uwsgi --ini /app/uwsgi.ini
autostart=true
autorestart=true
stdout_logfile=/app/logs/uwsgi.log
stdout_logfile_maxbytes=0
redirect_stderr=true

[program:celery]
; Set full path to celery program if using virtualenv
; To deal with "celery missed heartbeats from client" errors if that's actually an issue
; http://docs.celeryproject.org/en/latest/history/whatsnew-3.1.html?highlight=gossip#mingle-worker-synchronization
command=celery -A scremsong worker --loglevel=INFO --concurrency=2

; Alternatively,
;command=celery --app=your_app.celery:app worker --loglevel=INFO -n worker.%%h
; Or run a script
;command=celery.sh

directory=/app
user=nobody
numprocs=1
stdout_logfile=/app/logs/celery-worker.log
stderr_logfile=/app/logs/celery-worker.log
autostart=true
autorestart=true
startsecs=10

; Need to wait for currently executing tasks to finish at shutdown.
; Increase this if you have very long running tasks.
stopwaitsecs=10

; Causes supervisor to send the termination signal (SIGTERM) to the whole process group.
stopasgroup=true

; Set Celery priority higher than default (999)
; so, if rabbitmq is supervised, it will start first.
priority=1000
